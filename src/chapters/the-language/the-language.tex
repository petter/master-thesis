\chapter{The Langauge - PTS}\label{ch:the-langauge---pts}

\section{The PTS Grammar}\label{sec:the-pts-grammar}

PTS is an extension of TypeScript, and the grammar is also therefore an extension of the TypeScript grammar.
There is no published official TypeScript grammar (other than interpreting it from the implementation of the TypeScript compiler), however up until recently there used to be a TypeScript specification\cite{tsspec}.
This TypeScript specification was deprecated as it proved a to great a task to keep updated with the ever-changing nature of the language.
However, most of the essential parts are still the same.
The PTS grammar is therefore based on the TypeScript specification, and on the ESTree Specification\cite{estreespec}.

In figure~\vref{fig:pts-grammar} we can see the PTS BNF grammar.
This is not the full grammar for PTS, as I have only included any additions or changes to the original TypeScript/JavaScript grammars.
More specifically the non-terminal $\bnfpn{declaration}$ is an extension of the original grammar, where we also include package and template declarations as legal declarations.
The productions for non-terminals $\bnfpn{id}$, $\bnfpn{class declaration}$, $\bnfpn{interface declaration}$, and $\bnfpn{class body}$ are also from the original grammar.

\begin{figure}
    \begin{bnf*}
        \bnfprod{declaration}
        { \bnfsk \bnfor \bnfpn{package declaration} \bnfor \bnfpn{template declaration} }\\
        \bnfprod{package declaration}
        { \bnfts{pack} \bnfsp \bnfpn{id} \bnfsp \bnfpn{PT body} }\\
        \bnfprod{template declaration}
        { \bnfts{template} \bnfsp \bnfpn{id} \bnfsp \bnfpn{PT body} }\\
        \bnfprod{PT body}
        { \bnfts{\{} \bnfsp \bnfpn{PT body decls} \bnfsp \bnfts{\}} }\\
        \bnfprod{PT body decls}
        { \bnfpn{PT body decls} \bnfsp \bnfpn{PT body decl} \bnfor \bnfes}\\
        \bnfprod{PT body decl}
        { \bnfpn{inst statement} \bnfor \bnfpn{addto statement} \bnfor }\\
        \bnfmore{ \bnfpn{class declaration} \bnfor \bnfpn{interface declaration} }\\
        \bnfprod{inst statement}
        { \bnfts{inst} \bnfsp \bnfpn{id} \bnfsp \bnfpn{inst rename block} }\\
        \bnfprod{inst rename block}
        { \bnfts{\{} \bnfsp \bnfpn{class renamings} \bnfsp \bnfts{\}} \bnfor \bnfes }\\
        \bnfprod{class renamings}
        { \bnfpn{class rename} \bnfor \bnfpn{class rename} \bnfts{,} \bnfsp \bnfpn{class renamings} }\\
        \bnfprod{class rename}
        { \bnfpn{rename} \bnfsp \bnfpn{field rename block} }\\
        \bnfprod{field rename block}
        { \bnfts{(} \bnfsp \bnfpn{field renamings} \bnfsp \bnfts{)} \bnfor \bnfes }\\
        \bnfprod{field renamings}
        { \bnfpn{rename} \bnfor \bnfpn{rename} \bnfts{,} \bnfsp \bnfpn{field renamings} }\\
        \bnfprod{rename}
        { \bnfpn{id} \bnfsp \bnfts{->} \bnfsp \bnfpn{id} }\\
        \bnfprod{addto statement}
        { \bnfts{addto} \bnfsp \bnfpn{id} \bnfsp \bnfpn{addto heritage} \bnfsp \bnfpn{class body} }\\
        \bnfprod{addto heritage}
        { \bnfpn{class heritage} \bnfor \bnfes }\\
    \end{bnf*}
    \caption{BNF grammar for PTS. The non-terminals $\bnfpn{declaration}$, $\bnfpn{id}$, $\bnfpn{class declaration}$, $\bnfpn{interface declaration}$, and $\bnfpn{class body}$ are productions from the TypeScript grammar.
    The ellipsis in the declaration production means that we extend the TypeScript production with some extra choices.}

    \textit{Legend:} Non-terminals are surrounded by $\bnfpn{angle brackets}$.
    Terminals are in $\bnfts{typewriter font}$.
    Meta-symbols are in regular font.
    \label{fig:pts-grammar}
\end{figure}
